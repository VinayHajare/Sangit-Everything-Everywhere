{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{usePlayer}from\"../../context/PlayerContext\";import api from\"../../utils/api\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const SongPlayer=()=>{const{currentSong,clearSong}=usePlayer();const[audio,setAudio]=useState(null);// Audio element\nconst[isPlaying,setIsPlaying]=useState(false);const[duration,setDuration]=useState(0);// Song duration (seconds)\nconst[progress,setProgress]=useState(0);// Playback progress (seconds)\nconst[error,setError]=useState(\"\");useEffect(()=>{if(currentSong){fetchSongStream();}// Cleanup audio on unmount or when currentSong changes\nreturn()=>{if(audio){audio.pause();audio.removeEventListener(\"timeupdate\",handleTimeUpdate);audio.removeEventListener(\"ended\",handleSongEnd);}};},[currentSong,audio,fetchSongStream,handleSongEnd,handleTimeUpdate]);const fetchSongStream=async()=>{if(!currentSong)return;try{const response=await api.get(\"/stream/play/\".concat(currentSong.id),{responseType:\"blob\"});const url=URL.createObjectURL(response.data);const audioElement=new Audio(url);// Add event listeners\naudioElement.addEventListener(\"timeupdate\",handleTimeUpdate);audioElement.addEventListener(\"ended\",handleSongEnd);setAudio(audioElement);setDuration(audioElement.duration||0);setProgress(0);setIsPlaying(false);setError(\"\");}catch(_unused){setError(\"Failed to stream the song. Please try again.\");clearSong();}};const handleTimeUpdate=()=>{if(audio){setProgress(audio.currentTime);setDuration(audio.duration);}};const handleSongEnd=()=>{clearSong();setIsPlaying(false);setProgress(0);};// Play the song\nconst handlePlay=()=>{if(audio){audio.play();setIsPlaying(true);}};// Pause the song\nconst handlePause=()=>{if(audio){audio.pause();setIsPlaying(false);}};// Stop the song\nconst handleStop=()=>{if(audio){audio.pause();audio.currentTime=0;setIsPlaying(false);setProgress(0);}};const formatTime=time=>{const minutes=Math.floor(time/60);const seconds=Math.floor(time%60);return\"\".concat(minutes,\":\").concat(seconds<10?\"0\":\"\").concat(seconds);};if(!currentSong){return/*#__PURE__*/_jsx(\"div\",{className:\"bg-music-background text-white p-4\",children:\"No song selected\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-music-background text-white p-6 rounded shadow-md\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4\",children:currentSong.title}),error?/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-500 p-3 rounded\",children:error}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 mb-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handlePlay,disabled:isPlaying,className:\"py-2 px-4 rounded \".concat(isPlaying?\"bg-gray-600\":\"bg-music-primary hover:bg-green-600\"),children:\"Play\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handlePause,disabled:!isPlaying,className:\"py-2 px-4 rounded \".concat(isPlaying?\"bg-music-primary hover:bg-green-600\":\"bg-gray-600\"),children:\"Pause\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleStop,className:\"py-2 px-4 rounded bg-red-600 hover:bg-red-700\",children:\"Stop\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-800 h-2 rounded overflow-hidden mb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-music-primary h-2\",style:{width:\"\".concat(progress/duration*100||0,\"%\")}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex justify-between text-sm text-music-secondary mb-4\",children:[/*#__PURE__*/_jsx(\"span\",{children:formatTime(progress)}),/*#__PURE__*/_jsx(\"span\",{children:formatTime(duration)})]})]})]});};export default SongPlayer;","map":{"version":3,"names":["React","useEffect","useState","usePlayer","api","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","SongPlayer","currentSong","clearSong","audio","setAudio","isPlaying","setIsPlaying","duration","setDuration","progress","setProgress","error","setError","fetchSongStream","pause","removeEventListener","handleTimeUpdate","handleSongEnd","response","get","concat","id","responseType","url","URL","createObjectURL","data","audioElement","Audio","addEventListener","_unused","currentTime","handlePlay","play","handlePause","handleStop","formatTime","time","minutes","Math","floor","seconds","className","children","title","onClick","disabled","style","width"],"sources":["D:/Vinay Hajare/React Projects/music-streaming-frontend/src/components/Songs/SongPlayer.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { usePlayer } from \"../../context/PlayerContext\";\r\nimport api from \"../../utils/api\";\r\n\r\nconst SongPlayer = () => {\r\n  const { currentSong, clearSong } = usePlayer();\r\n  const [audio, setAudio] = useState(null); // Audio element\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [duration, setDuration] = useState(0); // Song duration (seconds)\r\n  const [progress, setProgress] = useState(0); // Playback progress (seconds)\r\n  const [error, setError] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (currentSong) {\r\n      fetchSongStream();\r\n    }\r\n\r\n    // Cleanup audio on unmount or when currentSong changes\r\n    return () => {\r\n      if (audio) {\r\n        audio.pause();\r\n        audio.removeEventListener(\"timeupdate\", handleTimeUpdate);\r\n        audio.removeEventListener(\"ended\", handleSongEnd);\r\n      }\r\n    };\r\n  }, [currentSong, audio, fetchSongStream, handleSongEnd, handleTimeUpdate]);\r\n\r\n  const fetchSongStream = async () => {\r\n    if (!currentSong) return;\r\n    try {\r\n      const response = await api.get(`/stream/play/${currentSong.id}`, {\r\n        responseType: \"blob\",\r\n      });\r\n      const url = URL.createObjectURL(response.data);\r\n      const audioElement = new Audio(url);\r\n\r\n      // Add event listeners\r\n      audioElement.addEventListener(\"timeupdate\", handleTimeUpdate);\r\n      audioElement.addEventListener(\"ended\", handleSongEnd);\r\n\r\n      setAudio(audioElement);\r\n      setDuration(audioElement.duration || 0);\r\n      setProgress(0);\r\n      setIsPlaying(false);\r\n      setError(\"\");\r\n    } catch {\r\n      setError(\"Failed to stream the song. Please try again.\");\r\n      clearSong();\r\n    }\r\n  };\r\n\r\n  const handleTimeUpdate = () => {\r\n    if (audio) {\r\n      setProgress(audio.currentTime);\r\n      setDuration(audio.duration);\r\n    }\r\n  };\r\n\r\n  const handleSongEnd = () => {\r\n    clearSong();\r\n    setIsPlaying(false);\r\n    setProgress(0);\r\n  };\r\n\r\n  // Play the song\r\n  const handlePlay = () => {\r\n    if (audio) {\r\n      audio.play();\r\n      setIsPlaying(true);\r\n    }\r\n  };\r\n\r\n  // Pause the song\r\n  const handlePause = () => {\r\n    if (audio) {\r\n      audio.pause();\r\n      setIsPlaying(false);\r\n    }\r\n  };\r\n\r\n  // Stop the song\r\n  const handleStop = () => {\r\n    if (audio) {\r\n      audio.pause();\r\n      audio.currentTime = 0;\r\n      setIsPlaying(false);\r\n      setProgress(0);\r\n    }\r\n  };\r\n\r\n  const formatTime = (time) => {\r\n    const minutes = Math.floor(time / 60);\r\n    const seconds = Math.floor(time % 60);\r\n    return `${minutes}:${seconds < 10 ? \"0\" : \"\"}${seconds}`;\r\n  };\r\n\r\n  if (!currentSong) {\r\n    return (\r\n      <div className=\"bg-music-background text-white p-4\">No song selected</div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-music-background text-white p-6 rounded shadow-md\">\r\n      <h2 className=\"text-2xl font-bold mb-4\">{currentSong.title}</h2>\r\n      {error ? (\r\n        <div className=\"bg-red-500 p-3 rounded\">{error}</div>\r\n      ) : (\r\n        <>\r\n          <div className=\"flex items-center gap-4 mb-4\">\r\n            <button\r\n              onClick={handlePlay}\r\n              disabled={isPlaying}\r\n              className={`py-2 px-4 rounded ${\r\n                isPlaying\r\n                  ? \"bg-gray-600\"\r\n                  : \"bg-music-primary hover:bg-green-600\"\r\n              }`}\r\n            >\r\n              Play\r\n            </button>\r\n            <button\r\n              onClick={handlePause}\r\n              disabled={!isPlaying}\r\n              className={`py-2 px-4 rounded ${\r\n                isPlaying\r\n                  ? \"bg-music-primary hover:bg-green-600\"\r\n                  : \"bg-gray-600\"\r\n              }`}\r\n            >\r\n              Pause\r\n            </button>\r\n            <button\r\n              onClick={handleStop}\r\n              className=\"py-2 px-4 rounded bg-red-600 hover:bg-red-700\"\r\n            >\r\n              Stop\r\n            </button>\r\n          </div>\r\n          <div className=\"w-full bg-gray-800 h-2 rounded overflow-hidden mb-4\">\r\n            <div\r\n              className=\"bg-music-primary h-2\"\r\n              style={{ width: `${(progress / duration) * 100 || 0}%` }}\r\n            ></div>\r\n          </div>\r\n          <div className=\"w-full flex justify-between text-sm text-music-secondary mb-4\">\r\n            <span>{formatTime(progress)}</span>\r\n            <span>{formatTime(duration)}</span>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SongPlayer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}